context("dt_compare")

set.seed(1)
x <- iris[1:50,]
y <- iris[1:60,]
x$id <- seq(nrow(x))
y$id <- seq(nrow(y))
y$Sepal.Width = y$Sepal.Width + rnorm(n = nrow(y))

test_that("correct values are returned", {
  expect_equivalent(as.data.frame(csmtools::dt_compare(x, y, compare = c("Sepal.Width", "Sepal.Length"), by = "id", all.y = TRUE)),
                    structure(list(id = 1:60, Sepal.Length.x = c(5.1, 4.9, 4.7, 4.6,
                                                                 5, 5.4, 4.6, 5, 4.4, 4.9, 5.4, 4.8, 4.8, 4.3, 5.8, 5.7, 5.4,
                                                                 5.1, 5.7, 5.1, 5.4, 5.1, 4.6, 5.1, 4.8, 5, 5, 5.2, 5.2, 4.7,
                                                                 4.8, 5.4, 5.2, 5.5, 4.9, 5, 5.5, 4.9, 4.4, 5.1, 5, 4.5, 4.4,
                                                                 5, 5.1, 4.8, 5.1, 4.6, 5.3, 5, NA, NA, NA, NA, NA, NA, NA, NA,
                                                                 NA, NA), Sepal.Width.x = c(3.5, 3, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4,
                                                                                            2.9, 3.1, 3.7, 3.4, 3, 3, 4, 4.4, 3.9, 3.5, 3.8, 3.8, 3.4, 3.7,
                                                                                            3.6, 3.3, 3.4, 3, 3.4, 3.5, 3.4, 3.2, 3.1, 3.4, 4.1, 4.2, 3.1,
                                                                                            3.2, 3.5, 3.6, 3, 3.4, 3.5, 2.3, 3.2, 3.5, 3.8, 3, 3.8, 3.2,
                                                                                            3.7, 3.3, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA), Petal.Length.x = c(1.4,
                                                                                                                                                                  1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.6, 1.4, 1.1,
                                                                                                                                                                  1.2, 1.5, 1.3, 1.4, 1.7, 1.5, 1.7, 1.5, 1, 1.7, 1.9, 1.6, 1.6,
                                                                                                                                                                  1.5, 1.4, 1.6, 1.6, 1.5, 1.5, 1.4, 1.5, 1.2, 1.3, 1.4, 1.3, 1.5,
                                                                                                                                                                  1.3, 1.3, 1.3, 1.6, 1.9, 1.4, 1.6, 1.4, 1.5, 1.4, NA, NA, NA,
                                                                                                                                                                  NA, NA, NA, NA, NA, NA, NA), Petal.Width.x = c(0.2, 0.2, 0.2,
                                                                                                                                                                                                                 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.2, 0.1, 0.1, 0.2, 0.4,
                                                                                                                                                                                                                 0.4, 0.3, 0.3, 0.3, 0.2, 0.4, 0.2, 0.5, 0.2, 0.2, 0.4, 0.2, 0.2,
                                                                                                                                                                                                                 0.2, 0.2, 0.4, 0.1, 0.2, 0.2, 0.2, 0.2, 0.1, 0.2, 0.2, 0.3, 0.3,
                                                                                                                                                                                                                 0.2, 0.6, 0.4, 0.3, 0.2, 0.2, 0.2, 0.2, NA, NA, NA, NA, NA, NA,
                                                                                                                                                                                                                 NA, NA, NA, NA), Species.x = structure(c(1L, 1L, 1L, 1L, 1L,
                                                                                                                                                                                                                                                          1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                                                                                                                                                                                                                                                          1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                                                                                                                                                                                                                                                          1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, NA, NA, NA,
                                                                                                                                                                                                                                                          NA, NA, NA, NA, NA, NA, NA), .Label = c("setosa", "versicolor",
                                                                                                                                                                                                                                                                                                  "virginica"), class = "factor"), Sepal.Length.y = c(5.1, 4.9,
                                                                                                                                                                                                                                                                                                                                                      4.7, 4.6, 5, 5.4, 4.6, 5, 4.4, 4.9, 5.4, 4.8, 4.8, 4.3, 5.8,
                                                                                                                                                                                                                                                                                                                                                      5.7, 5.4, 5.1, 5.7, 5.1, 5.4, 5.1, 4.6, 5.1, 4.8, 5, 5, 5.2,
                                                                                                                                                                                                                                                                                                                                                      5.2, 4.7, 4.8, 5.4, 5.2, 5.5, 4.9, 5, 5.5, 4.9, 4.4, 5.1, 5,
                                                                                                                                                                                                                                                                                                                                                      4.5, 4.4, 5, 5.1, 4.8, 5.1, 4.6, 5.3, 5, 7, 6.4, 6.9, 5.5, 6.5,
                                                                                                                                                                                                                                                                                                                                                      5.7, 6.3, 4.9, 6.6, 5.2), Sepal.Width.y = c(2.873546, 3.183643,
                                                                                                                                                                                                                                                                                                                                                                                                  2.364371, 4.695281, 3.929508, 3.079532, 3.887429, 4.138325, 3.475781,
                                                                                                                                                                                                                                                                                                                                                                                                  2.794612, 5.211781, 3.789843, 2.378759, 0.7853, 5.124931, 4.355066,
                                                                                                                                                                                                                                                                                                                                                                                                  3.88381, 4.443836, 4.621221, 4.393901, 4.318977, 4.482136, 3.674565,
                                                                                                                                                                                                                                                                                                                                                                                                  1.310648, 4.019826, 2.943871, 3.244204, 2.029248, 2.92185, 3.617942,
                                                                                                                                                                                                                                                                                                                                                                                                  4.45868, 3.297212, 4.487672, 4.146195, 1.72294, 2.785005, 3.10571,
                                                                                                                                                                                                                                                                                                                                                                                                  3.540687, 4.100025, 4.163176, 3.335476, 2.046638, 3.896963, 4.056663,
                                                                                                                                                                                                                                                                                                                                                                                                  3.111244, 2.292505, 4.164582, 3.968533, 3.587654, 4.181108, 3.598106,
                                                                                                                                                                                                                                                                                                                                                                                                  2.587974, 3.44112, 1.170637, 4.233024, 4.7804, 2.932779, 1.355865,
                                                                                                                                                                                                                                                                                                                                                                                                  3.46972, 2.564945), Petal.Length.y = c(1.4, 1.4, 1.3, 1.5, 1.4,
                                                                                                                                                                                                                                                                                                                                                                                                                                         1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.6, 1.4, 1.1, 1.2, 1.5, 1.3, 1.4,
                                                                                                                                                                                                                                                                                                                                                                                                                                         1.7, 1.5, 1.7, 1.5, 1, 1.7, 1.9, 1.6, 1.6, 1.5, 1.4, 1.6, 1.6,
                                                                                                                                                                                                                                                                                                                                                                                                                                         1.5, 1.5, 1.4, 1.5, 1.2, 1.3, 1.4, 1.3, 1.5, 1.3, 1.3, 1.3, 1.6,
                                                                                                                                                                                                                                                                                                                                                                                                                                         1.9, 1.4, 1.6, 1.4, 1.5, 1.4, 4.7, 4.5, 4.9, 4, 4.6, 4.5, 4.7,
                                                                                                                                                                                                                                                                                                                                                                                                                                         3.3, 4.6, 3.9), Petal.Width.y = c(0.2, 0.2, 0.2, 0.2, 0.2, 0.4,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0.3, 0.2, 0.2, 0.1, 0.2, 0.2, 0.1, 0.1, 0.2, 0.4, 0.4, 0.3, 0.3,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0.3, 0.2, 0.4, 0.2, 0.5, 0.2, 0.2, 0.4, 0.2, 0.2, 0.2, 0.2, 0.4,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0.1, 0.2, 0.2, 0.2, 0.2, 0.1, 0.2, 0.2, 0.3, 0.3, 0.2, 0.6, 0.4,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0.3, 0.2, 0.2, 0.2, 0.2, 1.4, 1.5, 1.5, 1.3, 1.5, 1.3, 1.6, 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           1.3, 1.4), Species.y = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 2L,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              2L, 2L, 2L, 2L, 2L), .Label = c("setosa", "versicolor", "virginica"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ), class = "factor"), Sepal.Width.x_Sepal.Width.y = c(0.626454,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.183643, 0.835629, -1.595281, -0.329508, 0.820468, -0.487429,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.738325, -0.575781, 0.305388, -1.511781, -0.389843, 0.621241,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    2.2147, -1.124931, 0.0449340000000005, 0.0161899999999999, -0.943836,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.821221, -0.593901, -0.918977, -0.782135999999999, -0.0745649999999998,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1.989352, -0.619826, 0.0561289999999999, 0.155796, 1.470752,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0.47815, -0.417942, -1.35868, 0.102788, -0.387672, 0.0538050000000005,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1.37706, 0.414995, 0.39429, 0.0593129999999999, -1.100025, -0.763176,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0.164524, 0.253362, -0.696963, -0.556663, 0.688756, 0.707495,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -0.364582, -0.768533, 0.112346, -0.881108, NA, NA, NA, NA, NA,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    NA, NA, NA, NA, NA), Sepal.Length.x_Sepal.Length.y = c(0, 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0, 0, 0, 0, 0, 0, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)), .Names = c("id",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  "Sepal.Length.x", "Sepal.Width.x", "Petal.Length.x", "Petal.Width.x",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  "Species.x", "Sepal.Length.y", "Sepal.Width.y", "Petal.Length.y",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  "Petal.Width.y", "Species.y", "Sepal.Width.x_Sepal.Width.y",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  "Sepal.Length.x_Sepal.Length.y"), row.names = c(NA, -60L), class = "data.frame"))
})


